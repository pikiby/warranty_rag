"""
prompts.py — правила общения для GPT в этом приложении.

Зачем нужен: хранит системный промпт и функцию сборки сообщений (system + контекст + вопрос),
чтобы GPT отвечал строго по базе знаний и не выдумывал.

Связано с:
- `app.py` — вызывает `build_messages(...)` перед запросом к GPT.
- `retriever.py` — поставляет контекст (чанки), который сюда передаётся строкой.
"""

SYSTEM_PROMPT = """
Ты — ассистент по базе знаний.

Правила:
- Отвечай ТОЛЬКО по предоставленному контексту.
- Если в контексте нет ответа, скажи: "В индексе базы знаний нет данных по запросу (или индекс не создан)."
- Не выдумывай факты, таблицы, поля, цифры, даты.
""".strip()


# Назначение: собрать сообщения для GPT (system + RAG-контекст + история диалога).
# Зачем: чтобы GPT видел предыдущие реплики и отвечал с учётом диалога, но при этом строго по найденному контексту.
# Связано с: `app.py::_answer_with_rag()`, которая передаёт результат в `client.chat.completions.create(...)`.
def build_messages(*, context, history):
    messages = [
        {"role": "system", "content": SYSTEM_PROMPT},
        {"role": "system", "content": f"КОНТЕКСТ:\n{context}".strip()},
    ]
    messages.extend(history)
    return messages



