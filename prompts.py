"""
prompts.py — правила общения для GPT в этом приложении.

Зачем нужен: хранит системный промпт и функцию сборки сообщений (system + контекст + вопрос),
чтобы GPT отвечал строго по базе знаний и не выдумывал.

Связано с:
- `app.py` — вызывает `build_messages(...)` перед запросом к GPT.
- `retriever.py` — поставляет контекст (чанки), который сюда передаётся строкой.
"""

SYSTEM_PROMPT = """
Ты — ассистент по базе знаний.

Правила:
- Отвечай ТОЛЬКО по предоставленному контексту.
- Если в контексте нет ответа, скажи: "В индексе базы знаний нет данных по запросу (или индекс не создан)."
- Не выдумывай факты, таблицы, поля, цифры, даты.
""".strip()


# Назначение: собрать минимальный промпт для строгого RAG-ответа.
# Связано с: `app.py::_answer_with_rag()`, которая передаёт сообщения в OpenAI chat-completions.
def build_messages(*, question, context):
    return [
        {"role": "system", "content": SYSTEM_PROMPT},
        {"role": "system", "content": f"КОНТЕКСТ:\n{context}".strip()},
        {"role": "user", "content": question.strip()},
    ]



